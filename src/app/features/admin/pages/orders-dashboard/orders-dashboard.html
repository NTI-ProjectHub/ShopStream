<div class="p-4">
  <h2 class="text-2xl font-bold text-indigo-700 mb-4">Orders Dashboard</h2>

  <!-- Error Message -->
  @if (errorMessage) {
    <div class="mb-4 p-4 bg-red-100 text-red-700 rounded-lg">
      {{ errorMessage }}
    </div>
  }

  <!-- Loading State -->
  @if (isLoading) {
    <div class="flex justify-center items-center">
      <svg class="animate-spin h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
      </svg>
    </div>
  } @else {
    <!-- Orders Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white rounded-lg shadow-md">
        <thead class="bg-indigo-600 text-white">
          <tr>
            <th class="py-3 px-4 text-left">Order ID</th>
            <th class="py-3 px-4 text-left">Customer</th>
            <th class="py-3 px-4 text-left">Restaurant</th>
            <th class="py-3 px-4 text-left">Total Price</th>
            <th class="py-3 px-4 text-left">Status</th>
            <th class="py-3 px-4 text-left">Delivery Address</th>
            <th class="py-3 px-4 text-left">Created At</th>
            <th class="py-3 px-4 text-left">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (order of orders; track order._id) {
            <tr class="border-b">
              <td class="py-3 px-4">{{ order._id | slice: 0:8 }}...</td>
              <td class="py-3 px-4">{{ order.customerId.name }} ({{ order.customerId.email }})</td>
              <td class="py-3 px-4">{{ order.restaurantId.name }}</td>
              <td class="py-3 px-4">${{ order.totalPrice.toFixed(2) }}</td>
              <td class="py-3 px-4">
                <span [ngClass]="{
                  'text-yellow-600': order.status === 'pending',
                  'text-blue-600': order.status === 'preparing',
                  'text-green-600': order.status === 'approved' || order.status === 'ready',
                  'text-red-600': order.status === 'cancelled'
                }">
                  {{ order.status | titlecase }}
                </span>
              </td>
              <td class="py-3 px-4">{{ order.deliveryAddress }}</td>
              <td class="py-3 px-4">{{ order.createdAt | date: 'short' }}</td>
              <td class="py-3 px-4">
                <select
                  #statusSelect
                  (change)="updateStatus(order._id, statusSelect.value)"
                  class="border rounded px-2 py-1 focus:ring-2 focus:ring-indigo-400">
                  <option value="pending" [selected]="order.status === 'pending'">Pending</option>
                  <option value="preparing" [selected]="order.status === 'preparing'">Preparing</option>
                  <option value="ready" [selected]="order.status === 'ready'">Ready</option>
                  <option value="approved" [selected]="order.status === 'approved'">Approved</option>
                  <option value="cancelled" [selected]="order.status === 'cancelled'">Cancelled</option>
                </select>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="8" class="py-3 px-4 text-center text-gray-500">No orders found.</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="mt-4 flex justify-between items-center">
      <div>
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
        {{ currentPage * itemsPerPage > totalOrders ? totalOrders : currentPage * itemsPerPage }} of
        {{ totalOrders }} orders
      </div>
      <div class="space-x-2">
        <button
          (click)="changePage(currentPage - 1)"
          [disabled]="currentPage === 1"
          class="px-4 py-2 bg-indigo-600 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
          Previous
        </button>
        <button
          (click)="changePage(currentPage + 1)"
          [disabled]="currentPage * itemsPerPage >= totalOrders"
          class="px-4 py-2 bg-indigo-600 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
          Next
        </button>
      </div>
    </div>
  }
</div>