<div class="flex max-w-7xl mx-auto">
  <!-- Sidebar -->
  <nav class="w-56 sticky top-4 h-fit bg-white shadow-lg p-4 mt-12 rounded-xl">
    <ul>
      @if (error) {
        <li class="text-red-500 text-sm">No menu items available</li>
      } @else {
        @for (section of sections; track section.id) {
          <li
            (click)="scrollTo(section.id)"
            class="cursor-pointer px-3 py-2 rounded-md mb-2 transition-colors"
            [ngClass]="activeSection === section.id ? 'bg-gray-200 font-bold' : 'text-gray-600 hover:bg-gray-100'"
            [attr.aria-current]="activeSection === section.id ? 'true' : 'false'"
            [attr.aria-label]="'Scroll to ' + section.name">
            {{ section.name }}
          </li>
        }
      }
    </ul>
  </nav>

  <!-- Content -->
  <main class="flex-1 p-6 space-y-12 mt-4">
    @if (error) {
      <p class="text-red-500 text-lg">{{ error }}</p>
    } @else if (sections.length > 0) {
      @for (section of sections; track section.id) {
        <section [id]="section.id" class="scroll-mt-20">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">{{ section.name }}</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            @for (item of section.items; track item._id; let i = $index) {
              <div class="flex rounded-xl overflow-hidden shadow-md hover:shadow-lg transition bg-white">
                <!-- Left (text) -->
                <div class="flex-1 p-4 flex flex-col justify-between">
                  <div>
                    <h3 class="font-semibold text-lg text-gray-900">{{ item.name }}</h3>
                    <p class="text-gray-500 text-sm mt-1">{{ item.description }}</p>
                    <p class="text-sm text-gray-400 mt-1">Category: {{ item.category }}</p>
                    <p class="text-sm mt-1" [ngClass]="item.isAvailable ? 'text-green-500' : 'text-red-500'">
                      {{ item.isAvailable ? 'Available' : 'Not Available' }}
                    </p>
                    <p class="text-sm font-semibold mt-2">Price: €{{ item.price ? item.price.toFixed(2) : 'N/A' }}</p>
                  </div>
                </div>
                <!-- Right (image + button) -->
                <div class="relative w-40">
                  <img
                    [src]="item.image !== 'No Image' ? item.image : 'imgs/img' + (i+2) + '.jpg'"
                    [alt]="item.name"
                    class="w-full h-full object-cover" />
                  <button
                    (click)="openOrder(item)"
                    [disabled]="!item.isAvailable"
                    class="absolute bottom-2 right-2 bg-white shadow rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-100 text-xl font-extrabold disabled:opacity-50"
                    [attr.aria-label]="'Add ' + item.name + ' to order'">
                    +
                  </button>
                </div>
              </div>
              <!-- Empty div for 2-card layout -->
              @if ((i + 1) % 2 === 0) {
                <div class="hidden md:block"></div>
              }
            }
          </div>
        </section>
      }
    } @else {
      <p class="text-gray-500">No menu items available.</p>
    }

    <!-- Modal -->
    @if (showOrder) {
      <div class="fixed inset-0 flex items-center justify-center bg-black/50 z-50">
        <div class="bg-white w-[500px] max-w-[90%] rounded-2xl shadow-lg p-6 relative">
          <!-- Header -->
          <div class="flex justify-between items-center mb-6">
            <button
              (click)="closeOrder()"
              class="text-2xl font-bold text-gray-600 hover:text-black"
              aria-label="Close order modal">
              ×
            </button>
            <button
              (click)="shareOrder()"
              class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm font-medium transition-colors">
              Share
            </button>
          </div>
          <!-- Content -->
          <div>
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Your Order</h2>
            @if (selectedItems.length > 0) {
              @for (item of selectedItems; track item._id; let i = $index) {
                <div class="flex justify-between items-center border-b py-2">
                  <span class="text-gray-700">{{ item.name }}</span>
                  <div class="flex items-center gap-2">
                    <span class="font-bold text-gray-900">€{{ item.price ? item.price.toFixed(2) : 'N/A' }}</span>
                    <button
                      (click)="removeItem(i)"
                      class="text-red-500 hover:text-red-700 text-sm"
                      [attr.aria-label]="'Remove ' + item.name + ' from order'">
                      Remove
                    </button>
                  </div>
                </div>
              }
            } @else {
              <p class="text-gray-500">No items in your order.</p>
            }
          </div>
        </div>
      </div>
    }
  </main>
</div>